[
    {
        "name": "Abnormal Permutation Pairs (hard version)",
        "description": "This is the hard version of the problem. The only difference between the easy\nversion and the hard version is the constraints on \n    n\n. You can only make\nhacks if both versions are solved. A permutation of \n    1, 2, \n    \u2026, n\n is\na sequence of \n    n\n integers, where each integer from \n    1\n to \n    n\n\nappears exactly once. For example, \n    [2,3,1,4]\n is a permutation of \n    1,\n    2, 3, 4\n, but \n    [1,4,2,2]\n isn't because \n    2\n appears twice in it.\nRecall that the number of inversions in a permutation \n    a_1, a_2, \n    \u2026,\n    a_n\n is the number of pairs of indices \n    (i, j)\n such that \n    i < j\n\nand \n    a_i > a_j\n. Let \n    p\n and \n    q\n be two permutations of \n    1, 2,\n    \n    \u2026, n\n. Find the number of permutation pairs \n    (p,q)\n that satisfy\nthe following conditions: \n    p\n is lexicographically smaller than \n    q\n.\nthe number of inversions in \n    p\n is greater than the number of inversions\nin \n    q\n. Print the number of such pairs modulo \n    mod\n. Note that\n\n    mod\n may not be a prime. Input The only line contains two integers\n\n    n\n and \n    mod\n (\n    1\n    \u2264 n\n    \u2264 500\n, \n    1\n    \u2264 mod\n    \u2264 10^9\n).\nOutput Print one integer, which is the answer modulo \n    mod\n. Example Input\n4 403458273 Output 17 Note The following are all valid pairs \n    (p,q)\n when\n\n    n=4\n. \n    p=[1,3,4,2]\n, \n    q=[2,1,3,4]\n, \n    p=[1,4,2,3]\n,\n\n    q=[2,1,3,4]\n, \n    p=[1,4,3,2]\n, \n    q=[2,1,3,4]\n, \n    p=[1,4,3,2]\n,\n\n    q=[2,1,4,3]\n, \n    p=[1,4,3,2]\n, \n    q=[2,3,1,4]\n, \n    p=[1,4,3,2]\n,\n\n    q=[3,1,2,4]\n, \n    p=[2,3,4,1]\n, \n    q=[3,1,2,4]\n, \n    p=[2,4,1,3]\n,\n\n    q=[3,1,2,4]\n, \n    p=[2,4,3,1]\n, \n    q=[3,1,2,4]\n, \n    p=[2,4,3,1]\n,\n\n    q=[3,1,4,2]\n, \n    p=[2,4,3,1]\n, \n    q=[3,2,1,4]\n, \n    p=[2,4,3,1]\n,\n\n    q=[4,1,2,3]\n, \n    p=[3,2,4,1]\n, \n    q=[4,1,2,3]\n, \n    p=[3,4,1,2]\n,\n\n    q=[4,1,2,3]\n, \n    p=[3,4,2,1]\n, \n    q=[4,1,2,3]\n, \n    p=[3,4,2,1]\n,\n\n    q=[4,1,3,2]\n, \n    p=[3,4,2,1]\n, \n    q=[4,2,1,3]\n.\n\n",
        "cf_contest_id": 1542,
        "cf_index": "E2",
        "cf_rating": 2700,
        "difficulty": 0,
        "cf_tags": [
            "combinatorics",
            "dp",
            "fft",
            "math"
        ],
        "time_limit_seconds": 4.0,
        "memory_limit_bytes": 512.0,
        "public_cases": [
            [
                "4 403458273\r\n",
                "17\r\n"
            ]
        ],
        "private_cases": [
            [
                "500 1\r\n",
                "0\r\n"
            ],
            [
                "500 2\r\n",
                "0\r\n"
            ],
            [
                "500 1000000000\r\n",
                "403758798\r\n"
            ],
            [
                "4 1\r\n",
                "0\r\n"
            ],
            [
                "1 1\r\n",
                "0\r\n"
            ],
            [
                "2 1\r\n",
                "0\r\n"
            ],
            [
                "1 167959139\r\n",
                "0\r\n"
            ],
            [
                "2 641009859\r\n",
                "0\r\n"
            ],
            [
                "3 524125987\r\n",
                "0\r\n"
            ],
            [
                "4 702209411\r\n",
                "17\r\n"
            ],
            [
                "5 585325539\r\n",
                "904\r\n"
            ],
            [
                "6 58376259\r\n",
                "45926\r\n"
            ],
            [
                "7 941492387\r\n",
                "2725016\r\n"
            ],
            [
                "8 824608515\r\n",
                "196884712\r\n"
            ],
            [
                "9 2691939\r\n",
                "1124976\r\n"
            ],
            [
                "10 802030518\r\n",
                "754910371\r\n"
            ],
            [
                "85 676225761\r\n",
                "309176546\r\n"
            ],
            [
                "144 435602783\r\n",
                "314269171\r\n"
            ],
            [
                "199 158791285\r\n",
                "21468342\r\n"
            ],
            [
                "233 330436384\r\n",
                "161830261\r\n"
            ],
            [
                "283 458175062\r\n",
                "191410709\r\n"
            ],
            [
                "324 286469538\r\n",
                "126984237\r\n"
            ],
            [
                "377 358523896\r\n",
                "185327697\r\n"
            ],
            [
                "480 71022479\r\n",
                "50578390\r\n"
            ],
            [
                "490 16364697\r\n",
                "5750437\r\n"
            ],
            [
                "499 29180922\r\n",
                "16940580\r\n"
            ],
            [
                "500 570226789\r\n",
                "309463818\r\n"
            ],
            [
                "11 685146646\r\n",
                "534097912\r\n"
            ],
            [
                "12 863230070\r\n",
                "612906984\r\n"
            ],
            [
                "13 41313494\r\n",
                "32605755\r\n"
            ],
            [
                "14 219396918\r\n",
                "172486793\r\n"
            ],
            [
                "15 102513046\r\n",
                "13918577\r\n"
            ],
            [
                "16 985629174\r\n",
                "794805824\r\n"
            ],
            [
                "17 458679894\r\n",
                "127170952\r\n"
            ],
            [
                "18 341796022\r\n",
                "261190161\r\n"
            ],
            [
                "19 519879446\r\n",
                "105365940\r\n"
            ],
            [
                "20 452405440\r\n",
                "386692452\r\n"
            ],
            [
                "40 43603670\r\n",
                "8542941\r\n"
            ],
            [
                "42 399770518\r\n",
                "301108922\r\n"
            ],
            [
                "103 925379796\r\n",
                "434825085\r\n"
            ],
            [
                "105 281546644\r\n",
                "212316632\r\n"
            ],
            [
                "111 954746654\r\n",
                "424464610\r\n"
            ],
            [
                "125 872744873\r\n",
                "674985974\r\n"
            ],
            [
                "140 18236383\r\n",
                "14226907\r\n"
            ],
            [
                "170 554776831\r\n",
                "261316079\r\n"
            ],
            [
                "177 211426207\r\n",
                "168418232\r\n"
            ],
            [
                "183 884626218\r\n",
                "356344824\r\n"
            ],
            [
                "195 741424885\r\n",
                "297224876\r\n"
            ],
            [
                "197 802624437\r\n",
                "235827120\r\n"
            ],
            [
                "207 211262336\r\n",
                "69003460\r\n"
            ],
            [
                "213 589495051\r\n",
                "395534279\r\n"
            ],
            [
                "246 365318475\r\n",
                "61467279\r\n"
            ],
            [
                "249 604601451\r\n",
                "255353490\r\n"
            ],
            [
                "257 339001014\r\n",
                "50567978\r\n"
            ],
            [
                "275 723775499\r\n",
                "198745587\r\n"
            ],
            [
                "284 341291190\r\n",
                "134723005\r\n"
            ],
            [
                "292 75690753\r\n",
                "61178751\r\n"
            ],
            [
                "302 484328652\r\n",
                "204230146\r\n"
            ],
            [
                "332 725901805\r\n",
                "543014324\r\n"
            ],
            [
                "365 501725229\r\n",
                "29577792\r\n"
            ],
            [
                "370 701874520\r\n",
                "85077156\r\n"
            ],
            [
                "387 154123011\r\n",
                "3163711\r\n"
            ],
            [
                "410 352085571\r\n",
                "251864653\r\n"
            ],
            [
                "413 886335843\r\n",
                "848191211\r\n"
            ],
            [
                "442 95049764\r\n",
                "84477907\r\n"
            ],
            [
                "470 275423364\r\n",
                "86380650\r\n"
            ],
            [
                "481 544073199\r\n",
                "511573391\r\n"
            ],
            [
                "482 427189327\r\n",
                "375910977\r\n"
            ],
            [
                "483 605272751\r\n",
                "516114874\r\n"
            ],
            [
                "484 488388879\r\n",
                "404396572\r\n"
            ],
            [
                "485 961439599\r\n",
                "572822060\r\n"
            ],
            [
                "486 844555727\r\n",
                "475008225\r\n"
            ],
            [
                "487 22639151\r\n",
                "5241678\r\n"
            ],
            [
                "488 200722575\r\n",
                "80869161\r\n"
            ],
            [
                "489 83838703\r\n",
                "64387688\r\n"
            ],
            [
                "491 194448122\r\n",
                "42613704\r\n"
            ],
            [
                "492 77564250\r\n",
                "11787983\r\n"
            ],
            [
                "493 255647674\r\n",
                "156337302\r\n"
            ],
            [
                "494 433731098\r\n",
                "297614712\r\n"
            ],
            [
                "495 611814522\r\n",
                "34391986\r\n"
            ],
            [
                "496 494930650\r\n",
                "236237125\r\n"
            ],
            [
                "497 673014074\r\n",
                "169088040\r\n"
            ],
            [
                "498 851097498\r\n",
                "297711052\r\n"
            ]
        ]
    }
]